# OCR連番管理システム 仕様書（ブラウザ版）

## 1. システム概要
- **目的**: iPhone または Webカメラで撮影した画像から券番号をOCRで抽出し、任意日付と店名を付与してリアルタイムに出力。チケットや金券などの番号管理を効率化する。
- **運用形態**: 完全ローカル（インターネット不要）、ブラウザ上で動作。

---

## 2. 要件

### 2.1 機能要件
| No | 機能 | 詳細 |
|----|------|------|
| F1 | 画像入力 | iPhoneカメラまたはPCのWebカメラから画像を取得 |
| F2 | OCR処理 | 画像から券番号を抽出 |
| F3 | 日付入力 | 任意の日付を入力するフィールドを用意 |
| F4 | 店名入力 | 任意のテキスト（店名）を入力するフィールドを用意 |
| F5 | 出力形式 | 券番号,日付,店名 の形式でテキストボックスに追記 |
| F6 | 連続読み取り | カメラ映像から自動でOCR → テキストボックスに追記 |
| F7 | 重複排除 | 同一券番号の重複出力は避ける（履歴管理で判定） |
| F8 | 精度向上（任意） | グレースケール変換・二値化・ノイズ除去などの前処理 |
| F9 | 言語 | 英数字認識のみ対象 |

### 2.2 非機能要件
| No | 要件 | 詳細 |
|----|------|------|
| N1 | 完全オフライン | ネットワーク不要で動作 |
| N2 | クロスプラットフォーム | iPhone Safari / Chrome / PCブラウザ |
| N3 | パフォーマンス | 1枚あたり1～2秒以内でOCR完了 |
| N4 | 保守性 | JS/TSで実装、容易に改修可能 |
| N5 | UI | コピペ用テキストボックス、日付・店名入力、カメラプレビュー表示 |

---

## 3. システム構成

┌───────────────────────────────┐
│ ブラウザUI │
│ ┌───────────────┐ │
│ │ 日付入力フィールド │ │
│ ├───────────────┤ │
│ │ 店名入力フィールド │ │
│ ├───────────────┤ │
│ │ カメラ映像 / 画像入力 │ │
│ └───────────────┘ │
│ ┌───────────────┐ │
│ │ コピペ用テキストボックス │ │
│ └───────────────┘ │
└───────────────┬───────────────┘
│
▼
┌─────────────────┐
│ Tesseract.js OCR │
│ 画像→券番号変換 │
└─────────────────┘

---

## 4. データフロー
1. 日付と店名を入力
2. Webカメラ映像を常時取得
3. 定期的にフレームをOCR処理
4. 新しい券番号を検出したらテキストボックスに追記
5. チケットを入れ替えて繰り返し
6. 重複券番号は出力しないように履歴管理で判定

---

## 5. UI仕様
| 要素 | 仕様 |
|------|------|
| 日付入力 | `<input type="date">` |
| 店名入力 | `<input type="text" placeholder="店名">` |
| カメラ映像 | `<video>` 常時表示、または `<input type="file" capture="environment">` |
| 出力表示 | `<textarea>` に `券番号,日付,店名` 形式で追記 |
| コピー機能 | `<textarea>`の内容は通常コピー可能 |
| 連続スキャン | OCR処理後、自動で次の券番号を検出 |

---

## 6. OCR精度向上策
- Canvasで前処理:
  - グレースケール化
  - 二値化（閾値処理）
  - ノイズ除去
- 数値⁺アルファベットが混じる場合がある。
- 複数数字の場合は全件取得、または最も明確なものを優先

---

## 7. 技術スタック
| 項目 | 技術/ライブラリ |
|------|----------------|
| 言語 | TypeScript / JavaScript |
| OCR | Tesseract.js |
| UI | HTML / CSS |
| 入力 | iPhoneカメラ、Webカメラ |
| デプロイ | ローカルブラウザ完結、PWA化も可能 |

---

## 8. 出力フォーマット例

```
券番号,日付,店名
1234,2025/10/01,AAA
2234,2025/10/01,BBB
3234,2025/10/02,CCC
```

- 区切りはカンマ (`,`)、必要に応じてタブ (`\t`) に変更可能
- コピペ用テキストボックスに1行ずつ追記され、即コピー可能

---

## 9. 今後の拡張
- Webカメラ映像のリアルタイムOCR（フレーム単位処理）
- CSV/JSON形式での保存
- 読み取り履歴の検索・並べ替え
- 複数ページ/複数エリア一括OCR
